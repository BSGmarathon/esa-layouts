import{y as P,d as S,c as U,J as p,a as f,D as A,k as m,o as u,j as o,b as _,A as i,B as d,F as C,r as j,t as V,G as H,L as h,H as F,n as z,R as W,i as q,z as G,N as J,S as K,l as O,m as Q}from"./index-CWzvgqpS.js";import{v as X}from"./vuetify-BmC0pzeD.js";import{d as Y,s as Z,c as ee}from"./pinia-BtNrPQ_B.js";import{E as v,q as te,F as $}from"./replicant_store-BPC1BbL0.js";import{D as le}from"./vuedraggable.umd-fRMDNXgw.js";import{M as R}from"./MediaCard-CdWsFjso.js";import"./_commonjsHelpers-BosuxZz1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";let B;const I=Y("intermissionPlayer",()=>{const k=P(!1),l=P(!1),r=P([]);function c(){var s;r.value=((s=v.data)==null?void 0:s.playlist)??[],l.value=!1}function n(){l.value=!0,clearTimeout(B),B=window.setTimeout(()=>{c()},30*1e3)}function e({sum:s,commercial:t}){r.value.push({sum:s,length:0,commercial:t??!0}),n()}async function a(){v.data&&(k.value=!0,v.data.playlist=te(r.value),v.save(),await new Promise(s=>{setTimeout(s,1e3)}),k.value=!1,clearTimeout(B),l.value=!1)}return{disableSave:k,localEdits:l,newPlaylist:r,save:a,playlistAdd:e,onLocalEdits:n,resetLocalPlaylist:c}}),ne={key:0},ae={style:{"margin-top":"10px"}},se={key:0,style:{"font-style":"italic"}},oe={style:{height:"250px","overflow-y":"scroll","overflow-x":"hidden",margin:0,padding:"10px"}},ie=["value"],re={class:"d-flex align-center",style:{"margin-right":"10px"}},de={style:{width:"25px","text-align":"center"}},ue=["title"],me=S({__name:"AvailableVideos",setup(k){const l=I(),r=P(null);function c(e){var a,s;return((s=(a=v.data)==null?void 0:a.plays)==null?void 0:s[e])||0}const n=U(()=>$.value.filter(e=>{const a=r.value?r.value.toLowerCase():"";return!a||a&&e.name.toLowerCase().includes(a)}).map(e=>[c(e.sum),e]).sort().map(e=>e[1]));return(e,a)=>{var w;const s=p("v-toolbar-title"),t=p("v-text-field"),g=p("v-icon"),b=p("v-btn");return m(v).data?(u(),f("div",ne,[o(s,null,{default:i(()=>a[1]||(a[1]=[d(" Available Videos ")])),_:1}),_("div",ae,[(w=m($))!=null&&w.length?(u(),f(C,{key:1},[o(t,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=y=>r.value=y),filled:"",clearable:"",label:"Search...","append-icon":"mdi-magnify",messages:`
            ${n.value.length} video${n.value.length===1?"":"s"} found.
          `},null,8,["modelValue","messages"]),_("div",oe,[(u(!0),f(C,null,j(n.value,y=>(u(),f("div",{key:y.sum,class:"d-flex align-center",value:y.sum,style:{margin:"5px","margin-left":0}},[_("div",re,[o(b,{icon:"",outlined:"",small:"",style:{"margin-right":"10px"},onClick:E=>m(l).playlistAdd({sum:y.sum,commercial:!0})},{default:i(()=>[o(g,{small:""},{default:i(()=>a[2]||(a[2]=[d(" mdi-playlist-plus ")])),_:1})]),_:2},1032,["onClick"]),o(g,null,{default:i(()=>a[3]||(a[3]=[d(" mdi-play ")])),_:1}),_("div",de,V(c(y.sum)),1)]),_("div",{title:y.name},V(y.name),9,ue)],8,ie))),128))])],64)):(u(),f("span",se,' Add videos under "Assets" > "esa-layouts" > "Videos". '))])])):A("",!0)}}}),pe=S({__name:"Playlist",setup(k){const l=I(),{newPlaylist:r,localEdits:c}=Z(l);function n(s){var t;return(t=$.value.find(g=>g.sum===s))==null?void 0:t.name}function e(s,t){l.newPlaylist[s].length=t}function a(s){l.newPlaylist.splice(s,1),l.onLocalEdits()}return(s,t)=>{const g=p("v-toolbar-title"),b=p("v-alert"),w=p("v-text-field"),y=p("v-icon"),E=p("v-btn");return u(),f("div",null,[o(g,null,{default:i(()=>t[3]||(t[3]=[d(" Playlist ")])),_:1}),H(o(b,{type:"warning",dense:"",style:{"margin-top":"5px"}},{default:i(()=>t[4]||(t[4]=[d(" Local changes have been made. ")])),_:1},512),[[F,m(c)]]),m(r).length?A("",!0):(u(),h(R,{key:0,style:{"font-style":"italic"}},{default:i(()=>t[5]||(t[5]=[d(" Add videos using the list above. ")])),_:1})),o(m(le),{modelValue:m(r),"onUpdate:modelValue":t[0]||(t[0]=x=>W(r)?r.value=x:null)},{item:i(({element:{sum:x,length:M,commercial:N},index:T})=>[(u(),h(R,{key:`${x}_${T}`,class:"d-flex align-center"},{default:i(()=>[o(w,{value:M,type:"number","hide-details":"",outlined:"",dense:"",spellcheck:"false",autocomplete:"off",style:{"max-width":"75px"},step:`${N?"30":"1"}`,min:"0",onInput:D=>e(T,D)},null,8,["value","step","onInput"]),_("div",{class:"d-flex justify-center flex-grow-1",style:z({overflow:"hidden","font-style":n(x)?void 0:"italic"})},[x?(u(),f(C,{key:0},[d(V(n(x)||"Could not find video name."),1)],64)):N?(u(),f(C,{key:1},[d(" Commercial w/o Video ")],64)):(u(),f(C,{key:2},[d(" Wait Block ")],64))],4),o(y,{onClick:D=>a(T),class:"mr-1"},{default:i(()=>t[6]||(t[6]=[d(" mdi-delete ")])),_:2},1032,["onClick"])]),_:2},1024))]),_:1},8,["modelValue"]),o(E,{block:"",class:"mt-3",onClick:t[1]||(t[1]=x=>m(l).playlistAdd({commercial:!0}))},{default:i(()=>t[7]||(t[7]=[d(" Add Commercial w/o Video to Playlist ")])),_:1}),o(E,{block:"",class:"mt-3",onClick:t[2]||(t[2]=x=>m(l).playlistAdd({commercial:!1}))},{default:i(()=>t[8]||(t[8]=[d(" Add Wait Block to Playlist ")])),_:1})])}}}),ce={key:0,style:{"text-align":"center"}},ve={key:0},fe={key:1},ye=S({__name:"CurrentVideoInfo",setup(k){const l=U(()=>{var c;return(c=$.value.find(n=>{var e;return n.sum===((e=v.data)==null?void 0:e.current)}))==null?void 0:c.name});function r(){nodecg.sendMessage("stopIntermissionPlayerEarly")}return(c,n)=>{const e=p("v-btn");return m(v).data?H((u(),f("div",ce,[n[1]||(n[1]=_("span",{class:"font-weight-bold"},"Currently Playing:",-1)),n[2]||(n[2]=_("br",null,null,-1)),l.value?(u(),f("span",ve,V(l.value),1)):(u(),f("span",fe,"Unknown (Usually Commercial w/o Video)")),o(e,{color:"red",class:"mt-2",onClick:r,block:""},{default:i(()=>n[0]||(n[0]=[d("Emergency Stop")])),_:1})],512)),[[F,m(v).data.playing]]):A("",!0)}}}),_e={class:"d-flex",style:{"margin-top":"20px"}},ge=S({__name:"main",setup(k){q({title:"Intermission Player control"});const l=I();function r(){var n;l.$patch({newPlaylist:((n=v.data)==null?void 0:n.playlist)??[],localEdits:!1})}G(()=>v.data,()=>{l.localEdits||l.resetLocalPlaylist()},{immediate:!0});async function c(){v.data&&await l.save()}return(n,e)=>{const a=p("v-btn"),s=p("v-icon"),t=p("v-tooltip"),g=p("v-app");return m(v).data?(u(),h(g,{key:0},{default:i(()=>[o(me),o(pe,{style:{"margin-top":"20px"}}),_("div",_e,[o(a,{class:"flex-grow-1",loading:m(l).disableSave,disabled:m(l).disableSave,onClick:e[0]||(e[0]=b=>c())},{default:i(()=>e[2]||(e[2]=[d(" Save ")])),_:1},8,["loading","disabled"]),o(t,{left:""},{activator:i(({targetRef:b})=>[o(a,J({style:{"margin-left":"5px"},onClick:e[1]||(e[1]=w=>r())},K(b)),{default:i(()=>[o(s,null,{default:i(()=>e[3]||(e[3]=[d(" mdi-refresh ")])),_:1})]),_:2},1040)]),default:i(()=>[e[4]||(e[4]=_("span",null,"Revert Local Changes",-1))]),_:1})]),o(ye,{style:{"margin-top":"10px"}})]),_:1})):A("",!0)}}}),L=O(ge),xe=Q(),ke=ee();L.use(xe);L.use(X);L.use(ke);L.mount("#app");
