import{z as P,d as $,c as U,J as m,a as v,o as d,l as s,b as y,B as a,C as r,j as c,F as C,r as M,t as V,G as h,L as T,i as D,H,n as j,R as z,k as W,A as q,N as G,S as J,m as K,p as O}from"./index-BRyf49M4.js";import{v as Q}from"./vuetify-Dxbcsmt7.js";import{d as X,s as Y,c as Z}from"./pinia--SozZtOi.js";import{E as S,F as b,q as ee}from"./replicant_store-BPGasNFT.js";import{D as te}from"./vuedraggable.umd-BZ65yjw2.js";import{M as R}from"./MediaCard-CrGKkGJ4.js";import"./_commonjsHelpers-BosuxZz1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const B=X("intermissionPlayer",()=>{const k=P(!1),i=P(!1),l=P([]);function p({sum:o,commercial:n}){l.value.push({sum:o,length:0,commercial:n??!0})}return{disableSave:k,localEdits:i,newPlaylist:l,playlistAdd:p}}),le={style:{"margin-top":"10px"}},ne={key:0,style:{"font-style":"italic"}},se={style:{height:"250px","overflow-y":"scroll","overflow-x":"hidden",margin:0,padding:"10px"}},oe=["value"],ae={class:"d-flex align-center",style:{"margin-right":"10px"}},ie={style:{width:"25px","text-align":"center"}},re=["title"],de=$({__name:"AvailableVideos",setup(k){const i=B(),l=P(null);function p(n){var e,u;return((u=(e=b.data)==null?void 0:e.plays)==null?void 0:u[n])||0}const o=U(()=>S.value.filter(n=>{const e=l.value?l.value.toLowerCase():"";return!e||e&&n.name.toLowerCase().includes(e)}).map(n=>[p(n.sum),n]).sort().map(n=>n[1]));return(n,e)=>{var x;const u=m("v-toolbar-title"),t=m("v-text-field"),_=m("v-icon"),w=m("v-btn");return d(),v("div",null,[s(u,null,{default:a(()=>e[1]||(e[1]=[r(" Available Videos ")])),_:1}),y("div",le,[(x=c(S))!=null&&x.length?(d(),v(C,{key:1},[s(t,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=f=>l.value=f),filled:"",clearable:"",label:"Search...","append-icon":"mdi-magnify",messages:`
            ${o.value.length} video${o.value.length===1?"":"s"} found.
          `},null,8,["modelValue","messages"]),y("div",se,[(d(!0),v(C,null,M(o.value,f=>(d(),v("div",{key:f.sum,class:"d-flex align-center",value:f.sum,style:{margin:"5px","margin-left":0}},[y("div",ae,[s(w,{icon:"",outlined:"",small:"",style:{"margin-right":"10px"},onClick:E=>c(i).playlistAdd({sum:f.sum,commercial:!0})},{default:a(()=>[s(_,{small:""},{default:a(()=>e[2]||(e[2]=[r(" mdi-playlist-plus ")])),_:1})]),_:2},1032,["onClick"]),s(_,null,{default:a(()=>e[3]||(e[3]=[r(" mdi-play ")])),_:1}),y("div",ie,V(p(f.sum)),1)]),y("div",{title:f.name},V(f.name),9,re)],8,oe))),128))])],64)):(d(),v("span",ne,' Add videos under "Assets" > "esa-layouts" > "Videos". '))])])}}}),ue=$({__name:"Playlist",setup(k){const i=B(),{newPlaylist:l,localEdits:p}=Y(i);function o(u){var t;return(t=S.value.find(_=>_.sum===u))==null?void 0:t.name}function n(u,t){i.newPlaylist[u].length=t}function e(u){i.newPlaylist.splice(u,1)}return(u,t)=>{const _=m("v-toolbar-title"),w=m("v-alert"),x=m("v-text-field"),f=m("v-icon"),E=m("v-btn");return d(),v("div",null,[s(_,null,{default:a(()=>t[3]||(t[3]=[r(" Playlist ")])),_:1}),h(s(w,{type:"warning",dense:"",style:{"margin-top":"5px"}},{default:a(()=>t[4]||(t[4]=[r(" Local changes have been made. ")])),_:1},512),[[H,c(p)]]),c(l).length?D("",!0):(d(),T(R,{key:0,style:{"font-style":"italic"}},{default:a(()=>t[5]||(t[5]=[r(" Add videos using the list above. ")])),_:1})),s(c(te),{modelValue:c(l),"onUpdate:modelValue":t[0]||(t[0]=g=>z(l)?l.value=g:null)},{item:a(({element:{sum:g,length:F,commercial:I},index:L})=>[(d(),T(R,{key:`${g}_${L}`,class:"d-flex align-center"},{default:a(()=>[s(x,{value:F,type:"number","hide-details":"",outlined:"",dense:"",spellcheck:"false",autocomplete:"off",style:{"max-width":"75px"},step:`${I?"30":"1"}`,min:"0",onInput:N=>n(L,N)},null,8,["value","step","onInput"]),y("div",{class:"d-flex justify-center flex-grow-1",style:j({overflow:"hidden","font-style":o(g)?void 0:"italic"})},[g?(d(),v(C,{key:0},[r(V(o(g)||"Could not find video name."),1)],64)):I?(d(),v(C,{key:1},[r(" Commercial w/o Video ")],64)):(d(),v(C,{key:2},[r(" Wait Block ")],64))],4),s(f,{onClick:N=>e(L),class:"mr-1"},{default:a(()=>t[6]||(t[6]=[r(" mdi-delete ")])),_:2},1032,["onClick"])]),_:2},1024))]),_:1},8,["modelValue"]),s(E,{block:"",class:"mt-3",onClick:t[1]||(t[1]=g=>c(i).playlistAdd({commercial:!0}))},{default:a(()=>t[7]||(t[7]=[r(" Add Commercial w/o Video to Playlist ")])),_:1}),s(E,{block:"",class:"mt-3",onClick:t[2]||(t[2]=g=>c(i).playlistAdd({commercial:!1}))},{default:a(()=>t[8]||(t[8]=[r(" Add Wait Block to Playlist ")])),_:1})])}}}),me={style:{"text-align":"center"}},pe={key:0},ce={key:1},ve=$({__name:"CurrentVideoInfo",setup(k){const i=U(()=>{var p;return(p=S.value.find(o=>{var n;return o.sum===((n=b.data)==null?void 0:n.current)}))==null?void 0:p.name});function l(){nodecg.sendMessage("stopIntermissionPlayerEarly")}return(p,o)=>{var e;const n=m("v-btn");return h((d(),v("div",me,[o[1]||(o[1]=y("span",{class:"font-weight-bold"},"Currently Playing:",-1)),o[2]||(o[2]=y("br",null,null,-1)),i.value?(d(),v("span",pe,V(i.value),1)):(d(),v("span",ce,"Unknown (Usually Commercial w/o Video)")),s(n,{color:"red",class:"mt-2",onClick:l,block:""},{default:a(()=>o[0]||(o[0]=[r("Emergency Stop")])),_:1})],512)),[[H,(e=c(b).data)==null?void 0:e.playing]])}}}),fe={class:"d-flex",style:{"margin-top":"20px"}},ye=$({__name:"main",setup(k){W({title:"Intermission Player control"});let i;const l=B();function p(){var n;l.newPlaylist=((n=b.data)==null?void 0:n.playlist)??[],l.localEdits=!1}q(()=>l.newPlaylist,()=>{l.localEdits=!0,clearTimeout(i),i=window.setTimeout(()=>{p()},30*1e3)},{deep:!0});async function o(){l.disableSave=!0,b.data.playlist=ee(l.newPlaylist),await new Promise(n=>{setTimeout(n,1e3)}),l.disableSave=!1,clearTimeout(i),l.localEdits=!1}return(n,e)=>{const u=m("v-btn"),t=m("v-icon"),_=m("v-tooltip"),w=m("v-app");return c(b).data?(d(),T(w,{key:0},{default:a(()=>[s(de),s(ue,{style:{"margin-top":"20px"}}),y("div",fe,[s(u,{class:"flex-grow-1",loading:c(l).disableSave,disabled:c(l).disableSave,onClick:e[0]||(e[0]=x=>o())},{default:a(()=>e[2]||(e[2]=[r(" Save ")])),_:1},8,["loading","disabled"]),s(_,{left:""},{activator:a(({targetRef:x})=>[s(u,G({style:{"margin-left":"5px"},onClick:e[1]||(e[1]=f=>p())},J(x)),{default:a(()=>[s(t,null,{default:a(()=>e[3]||(e[3]=[r(" mdi-refresh ")])),_:1})]),_:2},1040)]),default:a(()=>[e[4]||(e[4]=y("span",null,"Revert Local Changes",-1))]),_:1})]),s(ve,{style:{"margin-top":"10px"}})]),_:1})):D("",!0)}}}),A=K(ye),_e=O(),ge=Z();A.use(_e);A.use(Q);A.use(ge);A.mount("#app");
